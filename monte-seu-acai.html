<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#f5f3ff" />
  <title>LP Grill ‚Äî Monte seu A√ßa√≠</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body class="app">

  <header class="cover">
    <div class="cover-bg" aria-hidden="true"></div>

    <div class="topbar">
      <div class="brand">
        <a class="backlink" href="index.html" aria-label="Voltar ao menu">‚Üê</a>

        <div class="brand-txt">
          <h1>Monte seu A√ßa√≠</h1>
          <p>Escolha 1 tamanho + adicionais</p>
        </div>
      </div>

      <button class="cart-btn" id="openCart" aria-label="Abrir carrinho">
        <span class="cart-ico">üõí</span>
        <span class="cart-badge" id="cartCount">0</span>
      </button>
    </div>

    <div class="cover-info" id="infoBar"></div>
  </header>

  <main class="container">
    <section class="panel">
      <div class="panel-head">
        <h2>1) Tamanho (obrigat√≥rio)</h2>
        <p class="muted">Selecione 1 op√ß√£o para liberar ‚ÄúAdicionar ao carrinho‚Äù.</p>
      </div>
      <div class="builder-grid" id="acaiSizes"></div>
    </section>

    <section class="panel">
      <div class="panel-head">
        <h2>2) Acr√©scimos</h2>
        <p class="muted">Voc√™ pode escolher v√°rios.</p>
      </div>
      <div class="builder-grid" id="acaiExtras"></div>
    </section>

    <section class="panel">
      <div class="builder-footer">
        <div>
          <div class="muted">Total do item</div>
          <div class="builder-total" id="acaiTotal">R$ 0,00</div>
        </div>

        <button class="btn primary" id="addAcaiToCart" disabled>
          Adicionar ao carrinho
        </button>
      </div>

      <div style="margin-top:10px">
        <a class="btn light" href="finalizar.html" style="width:100%">Ir para Finalizar</a>
      </div>
    </section>
  </main>

  <a class="wa-float" id="waFloat" href="#" aria-label="WhatsApp">
    <img src="img/whatsapp.png" alt="WhatsApp" onerror="this.remove(); this.parentElement.textContent='WhatsApp';">
  </a>

  <div class="sticky-cta" id="stickyCTA" hidden>
    <button class="cta" id="ctaOpenCart" type="button">
      <span>Ver carrinho</span>
      <strong id="ctaTotal">R$ 0,00</strong>
    </button>
    <a class="cta primary" href="finalizar.html">Finalizar</a>
  </div>

  <!-- Carrinho (mesmo do index) -->
  <aside class="drawer" id="cartDrawer" aria-hidden="true">
    <div class="drawer-backdrop" id="closeCartBackdrop"></div>
    <div class="drawer-panel" role="dialog" aria-modal="true" aria-label="Carrinho">
      <div class="drawer-head">
        <div>
          <h3>Seu carrinho</h3>
          <p class="muted">Itens + taxa (se entrega)</p>
        </div>
        <button class="icon-btn" id="closeCart" aria-label="Fechar">‚úï</button>
      </div>

      <div class="drawer-body">
        <div class="delivery-toggle">
          <button class="dt-btn" id="modeEntrega" type="button">üöö Entrega</button>
          <button class="dt-btn" id="modeRetirar" type="button">üè¨ Retirar</button>
        </div>

        <div id="cartItems"></div>
      </div>

      <div class="drawer-foot">
        <div class="totals">
          <div class="row"><span>Subtotal</span><strong id="subTotal">R$ 0,00</strong></div>
          <div class="row"><span>Taxa</span><strong id="deliveryFee">R$ 0,00</strong></div>
          <div class="row total"><span>Total</span><strong id="grandTotal">R$ 0,00</strong></div>
          <div class="mini muted">‚è±Ô∏è Tempo m√©dio: <span id="etaText">30‚Äì60 min</span></div>
        </div>

        <div class="drawer-actions">
          <button class="btn light" id="clearCart" type="button">Limpar</button>
          <a class="btn primary" href="finalizar.html">Finalizar</a>
        </div>
      </div>
    </div>
  </aside>

  <script src="js/data.js"></script>
  <script src="js/cart.js"></script>
  <script src="js/app.js"></script>

  <!-- Script da p√°gina (visual e carrinho) -->
  <script>
    const ACaiData = (window.DATA && window.DATA.monteAcai) ? window.DATA.monteAcai : {
      sizes: [
        { id:"300",  name:"300ml",  price:12.00 },
        { id:"500",  name:"500ml",  price:18.00 },
        { id:"700",  name:"700ml",  price:24.00 },
        { id:"1000", name:"1 Litro", price:32.00 }
      ],
      extras: [
        { id:"leite_po", name:"Leite em p√≥", price:2.50 },
        { id:"pacoca", name:"Pa√ßoca", price:2.50 },
        { id:"granola", name:"Granola", price:2.50 },
        { id:"castanha", name:"Castanha", price:3.50 },
        { id:"chocoball", name:"Chocoball", price:3.00 },
        { id:"ovomaltine", name:"Ovomaltine", price:4.00 },
        { id:"banana", name:"Banana", price:2.50 },
        { id:"morango", name:"Morango", price:4.00 },
        { id:"kiwi", name:"Kiwi", price:4.50 },
        { id:"nutella", name:"Nutella", price:5.00 },
        { id:"doce_leite", name:"Doce de leite", price:3.50 },
        { id:"mel", name:"Mel", price:3.00 }
      ]
    };

    const money = (v)=> v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
    const $ = (s)=> document.querySelector(s);

    let selectedSize = null;
    const selectedExtras = new Set();

    function makeChoiceCard({title, sub, price, active, onClick}) {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "choice" + (active ? " active" : "");
      btn.innerHTML = `
        <div class="choice-left">
          <div class="choice-title">${title}</div>
          <div class="choice-sub muted">${sub || ""}</div>
        </div>
        <div class="choice-price">${money(price)}</div>
      `;
      btn.addEventListener("click", onClick);
      return btn;
    }

    function calcTotal(){
      let t = 0;
      if(selectedSize) t += selectedSize.price;
      for(const id of selectedExtras){
        const it = ACaiData.extras.find(e=>e.id===id);
        if(it) t += it.price;
      }
      return t;
    }

    function updateTotal(){
      $("#acaiTotal").textContent = money(calcTotal());
      $("#addAcaiToCart").disabled = !selectedSize;
    }

    function render(){
      const sizesEl  = $("#acaiSizes");
      const extrasEl = $("#acaiExtras");
      sizesEl.innerHTML = "";
      extrasEl.innerHTML = "";

      ACaiData.sizes.forEach(s=>{
        sizesEl.appendChild(makeChoiceCard({
          title: s.name,
          sub: "Base do a√ßa√≠",
          price: s.price,
          active: selectedSize?.id === s.id,
          onClick: ()=>{
            selectedSize = s;
            render(); // simples e est√°vel
          }
        }));
      });

      ACaiData.extras.forEach(x=>{
        const on = selectedExtras.has(x.id);
        extrasEl.appendChild(makeChoiceCard({
          title: x.name,
          sub: on ? "Selecionado" : "Toque para adicionar",
          price: x.price,
          active: on,
          onClick: ()=>{
            if(on) selectedExtras.delete(x.id);
            else selectedExtras.add(x.id);
            render();
          }
        }));
      });

      updateTotal();
    }

    function getCart(){
      if(typeof window.cartGet === "function") return window.cartGet();
      try{ return JSON.parse(localStorage.getItem("lp_cart") || "[]"); }catch(e){ return []; }
    }
    function setCart(c){
      if(typeof window.cartSet === "function") return window.cartSet(c);
      localStorage.setItem("lp_cart", JSON.stringify(c));
    }

    $("#addAcaiToCart").addEventListener("click", ()=>{
      if(!selectedSize) return;

      const extrasArr = Array.from(selectedExtras).map(id=>{
        const it = ACaiData.extras.find(e=>e.id===id);
        return it ? { id: it.id, name: it.name, price: it.price } : null;
      }).filter(Boolean);

      const item = {
        id: "monte-acai-" + Date.now(),
        name: `Monte seu A√ßa√≠ ‚Äî ${selectedSize.name}`,
        qty: 1,
        price: calcTotal(),
        meta: { size: selectedSize, extras: extrasArr }
      };

      const cart = getCart();
      cart.push(item);
      setCart(cart);

      if(typeof window.openCart === "function") window.openCart();
    });

    render();
  </script>
</body>
</html>
