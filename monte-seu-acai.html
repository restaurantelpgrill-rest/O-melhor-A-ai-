<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#0b0b0c" />
  <title>LP Grill — Monte seu Açaí</title>

  <link rel="stylesheet" href="css/estilo.css" />

  <style>
    /* fallback caso seu CSS geral falhe */
    .page{max-width:980px;margin:0 auto;padding:16px}
    .headrow{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .back{display:inline-flex;align-items:center;gap:10px;text-decoration:none}
    .back strong{font-size:14px}
    .card{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:18px;padding:14px;margin:12px 0}
    .grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
    @media (max-width:720px){.grid{grid-template-columns:1fr}}
    .opt{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px;border-radius:14px;border:1px solid rgba(255,255,255,.10);background:rgba(0,0,0,.25);cursor:pointer}
    .opt:hover{border-color:rgba(34,197,94,.55)}
    .opt.active{border-color:rgba(34,197,94,.95);box-shadow:0 0 0 3px rgba(34,197,94,.20) inset}
    .muted{opacity:.8;font-size:13px}
    .price{font-weight:800}
    .row{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .totalbox{display:flex;align-items:baseline;gap:10px}
    .total{font-size:28px;font-weight:900}
    .btn{appearance:none;border:0;border-radius:14px;padding:14px 14px;font-weight:900;cursor:pointer}
    .btn.ok{background:#22c55e;color:#07140b}
    .btn.ok:disabled{opacity:.45;cursor:not-allowed}
  </style>
</head>

<body>
  <main class="page">
    <div class="headrow">
      <a class="back" href="index.html">
        <strong>← Voltar ao Menu</strong>
      </a>
      <div class="muted">Monte seu Açaí • escolha 1 tamanho + adicionais</div>
    </div>

    <h1 style="margin:12px 0 6px">Monte seu Açaí</h1>
    <p class="muted" style="margin:0 0 10px">Selecione o <b>tamanho obrigatório</b> para liberar “Adicionar ao carrinho”.</p>

    <section class="card">
      <h2 style="margin:0 0 10px">1) Tamanho (obrigatório)</h2>
      <div id="sizes" class="grid"></div>
    </section>

    <section class="card">
      <h2 style="margin:0 0 10px">2) Acréscimos</h2>
      <div id="extras" class="grid"></div>
    </section>

    <section class="card">
      <div class="row">
        <div class="totalbox">
          <span class="muted">Total do item</span>
          <span class="total" id="total">R$ 0,00</span>
        </div>
        <button class="btn ok" id="addBtn" disabled>Adicionar ao carrinho</button>
      </div>
      <p class="muted" style="margin:10px 0 0">Taxa de entrega aparece no total final (se Entrega).</p>
    </section>
  </main>

  <script>
    // ======= DADOS (edite aqui se quiser) =======
    const DATA = {
      sizes: [
        { id:"300",  name:"300ml",  price: 12.00 },
        { id:"500",  name:"500ml",  price: 18.00 },
        { id:"700",  name:"700ml",  price: 24.00 },
        { id:"1000", name:"1 Litro", price: 32.00 }
      ],
      extras: [
        { id:"leite_po", name:"Leite em pó", price: 2.50 },
        { id:"paçoca", name:"Paçoca", price: 2.50 },
        { id:"granola", name:"Granola", price: 2.50 },
        { id:"castanha", name:"Castanha", price: 3.50 },
        { id:"chocoball", name:"Chocoball", price: 3.00 },
        { id:"ovomaltine", name:"Ovomaltine", price: 4.00 },
        { id:"banana", name:"Banana", price: 2.50 },
        { id:"morango", name:"Morango", price: 4.00 },
        { id:"kiwi", name:"Kiwi", price: 4.50 },
        { id:"nutella", name:"Nutella", price: 5.00 },
        { id:"doce_leite", name:"Doce de leite", price: 3.50 },
        { id:"mel", name:"Mel", price: 3.00 }
      ]
    };

    // ======= UTIL =======
    const money = (v)=> v.toLocaleString("pt-BR",{style:"currency",currency:"BRL"});
    const $ = (s)=> document.querySelector(s);

    // ======= ESTADO =======
    let selectedSize = null;
    const selectedExtras = new Set();

    // ======= RENDER =======
    function render() {
      const sizesEl = $("#sizes");
      const extrasEl = $("#extras");
      sizesEl.innerHTML = "";
      extrasEl.innerHTML = "";

      DATA.sizes.forEach(s=>{
        const el = document.createElement("button");
        el.type="button";
        el.className = "opt" + (selectedSize?.id===s.id ? " active":"");
        el.innerHTML = `
          <div>
            <div style="font-weight:900">${s.name}</div>
            <div class="muted">Base do açaí</div>
          </div>
          <div class="price">${money(s.price)}</div>
        `;
        el.onclick = ()=>{ selectedSize = s; update(); };
        sizesEl.appendChild(el);
      });

      DATA.extras.forEach(x=>{
        const on = selectedExtras.has(x.id);
        const el = document.createElement("button");
        el.type="button";
        el.className = "opt" + (on ? " active":"");
        el.innerHTML = `
          <div>
            <div style="font-weight:900">${x.name}</div>
            <div class="muted">${on ? "Selecionado" : "Toque para adicionar"}</div>
          </div>
          <div class="price">${money(x.price)}</div>
        `;
        el.onclick = ()=>{
          if(selectedExtras.has(x.id)) selectedExtras.delete(x.id);
          else selectedExtras.add(x.id);
          update();
        };
        extrasEl.appendChild(el);
      });

      update();
    }

    function calcTotal(){
      let t = 0;
      if(selectedSize) t += selectedSize.price;
      for(const id of selectedExtras){
        const it = DATA.extras.find(e=>e.id===id);
        if(it) t += it.price;
      }
      return t;
    }

    function update(){
      const total = calcTotal();
      $("#total").textContent = money(total);
      $("#addBtn").disabled = !selectedSize;
      // re-render só o visual "active"
      renderActiveStates();
    }

    function renderActiveStates(){
      // reaplica classes sem refazer tudo
      document.querySelectorAll("#sizes .opt").forEach((btn,i)=>{
        const s = DATA.sizes[i];
        btn.classList.toggle("active", selectedSize?.id===s.id);
      });
      document.querySelectorAll("#extras .opt").forEach((btn,i)=>{
        const x = DATA.extras[i];
        btn.classList.toggle("active", selectedExtras.has(x.id));
      });
    }

    // ======= CARRINHO (localStorage) =======
    function getCart(){
      try{ return JSON.parse(localStorage.getItem("lp_cart")||"[]"); }catch(e){ return []; }
    }
    function setCart(cart){
      localStorage.setItem("lp_cart", JSON.stringify(cart));
    }

    $("#addBtn").addEventListener("click", ()=>{
      if(!selectedSize) return;

      const extrasArr = Array.from(selectedExtras).map(id=>{
        const it = DATA.extras.find(e=>e.id===id);
        return it ? { id: it.id, name: it.name, price: it.price } : null;
      }).filter(Boolean);

      const item = {
        type: "monte_acai",
        name: `Monte seu Açaí — ${selectedSize.name}`,
        size: { id: selectedSize.id, name: selectedSize.name, price: selectedSize.price },
        extras: extrasArr,
        total: calcTotal(),
        qty: 1
      };

      const cart = getCart();
      cart.push(item);
      setCart(cart);

      // volta pro menu (ou você pode mandar pra finalizar.html se preferir)
      window.location.href = "index.html";
    });

    render();
  </script>
</body>
</html>
